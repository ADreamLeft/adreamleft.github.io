# 背景介绍

量化投资是一种基于数据分析和数学模型的投资方法，通过自动化交易策略减少人为情绪干扰，提高投资效率和收益稳定性。限价订单簿（Limit Order Book, LOB）作为金融市场微观结构的核心组成部分，记录了市场中所有未成交的买卖订单，为量化策略提供了丰富的信息来源。通过分析限价订单簿中的买卖价格、订单数量和市场深度等数据，可以揭示市场的短期价格行为与流动性特征，为构建高频交易策略提供重要依据。

本数据分析大作业旨在基于万科 A 的限价订单簿高频数据，探索市场微观结构中的潜在规律，并利用机器学习方法设计量化投资策略。通过对订单簿数据的深入分析，我们希望能够构建有效的交易方向预测模型，优化交易决策，并为实际投资提供理论支持和实践指导。报告正文部分分为 5 个部分，分别是特征选择，数据预处理，基础模型训练，针对 Logistics 模型的分析和优化，回测分析。

# 特征选择

数据集来自于万科 A 的限价订单簿高频数据，包含了 2017 年 1 月 3 日至 2017 年 2 月 17 日的交易数据，为 tick-by-tick 数据，共 10 万条，包含了买价卖价、买量卖量、成交价格和交易方向等信息。我们在处理时，首先根据数据的特点，提取了一系列与市场微观结构相关的特征，大致分为三类：

1. 基本特征：买卖价差、交易中间价格、买量卖量及其不平衡程度等
2. 时间不敏感特征：买卖价斜率、偏度和集中程度等，订单深度，买压卖压等
3. 时间敏感特征：交易价格变化率、交易价格波动率、价格动量等

这些特征旨在全面反映市场的价格行为和流动性特征，为后续的模型训练和交易决策提供有效的信息依据。

# 数据预处理

选取特征后，我们对数据进行了预处理，主要包括以下几个步骤：

1. 缺失值处理：这里主要是对于时间敏感特征的处理，由于数据是 tick-by-tick 数据，因此我们采用了向前填充和向后填充的方法，保证数据的完整性
2. 去极值：对特征进行去极值处理，消除极端值对模型训练的干扰
3. 数据标准化：对特征进行标准化处理，消除量纲差异，提高模型训练效率

对处理后的数据进行统计分析，并且绘制热力图如下：
![[数据热力图.png]]

# 基础模型训练

已经得到了与处理后的数据，接下来我们采用合适的模型对数据进行训练，以期得到一个较好的预测效果。由于预测买卖方向为分类问题，因此本文选择了五种模型：

1. SVM
2. Logistic 回归
3. 决策树
4. 朴素贝叶斯
5. 集成模型

训练数据和验证数据采用 train_test_split 方法进行划分，其中训练数据占 80%，验证数据占 20%。对于每个模型，我们分别计算了其准确率和 RUC 曲线，以评估模型的预测效果。

## 1 SVM

支持向量机（Support Vector Machine, SVM）是一种二分类模型，其基本模型是定义在特征空间上的间隔最大的线性分类器，其学习策略便是间隔最大化。在本文中，我们使用了 SVM 模型对数据进行训练，并且输出了其准确率和 RUC 曲线
![[SVM accuracy.png]]

## 2 Logistic 回归

逻辑回归（Logistic Regression）是一种广义线性回归分析模型，逻辑回归的因变量是一个二分类变量。在本文中，我们使用了 Logistic 回归模型对数据进行训练，并且输出了其准确率和 RUC 曲线。

![[Logistics.png]]

## 3 决策树

决策树（Decision Tree）是一种树形结构的分类器，其内部节点表示一个特征或属性，叶节点表示一个类别。在本文中，我们使用了决策树模型对数据进行训练，并且输出了其准确率和 RUC 曲线。
![[决策树 RUC.png]]

## 4 朴素贝叶斯

朴素贝叶斯（Naive Bayes）是一种基于贝叶斯定理和特征条件独立假设的分类器。在本文中，针对二分类问题，我们使用了朴素贝叶斯模型中的 BernoulliNB 对数据进行训练，并且输出了其准确率和 RUC 曲线。

![[NB RUC.png]]

## 5 集成模型

集成学习（Ensemble Learning）是一种通过构建多个模型组合的方法，以提高模型的泛化能力和预测准确率。在本文中，我们使用了集成模型中的随机森林（Random Forest）对数据进行训练，并且输出了其准确率和 RUC 曲线。

![[集成模型 RUC.png]]

# 针对 Logistics 模型的分析和优化

经过以上基础模型的训练，我们发现 Logistics 模型在准确率和 RUC 曲线上表现较好，因此我们对 Logistics 模型进行了进一步的分析和优化，主要包括以下几个方面：

## 1 根据特征的系数，分析特征的重要性

1. 由于我们的数据已经进行了标准化处理，因此可以直接根据特征的系数大小来判断特征的重要性
2. 我们绘制了特征的重要性图，以便更直观地分析特征的贡献度

![[features.png]]

## 2 通过调整参数、正则化、集成方法等对模型进行改进

1. 参数调整：首先我们对于特征进行了简单处理，剔除了系数绝对值小于 0.05 的特征，以减少模型的复杂度
   利用调整参数后的模型进行训练，发现其准确率有微小的提升，但是 AUC 减小，说明简单的剔除某一些参数对于模型不能带来直接的帮助。
   ![[特征工程.png]]

2. 正则化：于是我们采取正则化的方式，分别使用 Lasso 回归（L 1 正则化）和 Ridge 回归（L 2 正则化）对模型进行正则化处理，以减少模型的过拟合程度。
   我们发现在 l 2 正则化下，模型的准确率有所提升，l 1 正则化下，模型的准确率有所下降。这和调整参数时的结论是一致的：由于 l 1 正则化会使得一部分特征的系数变为 0，因此可能会损失一些重要信息。
   ![[正则化.png]]

   此外，我们还尝试了利用 GridSearchCV 对模型进行参数调整，设置交叉验证参数 cv=5，发现在 l 2 正则化，C=100 时，模型的准确率最高。
   ![[GridSearch.png]]
   在调整超参数后，再次训练模型，发现其准确率确实有所提升。
   ![[量.png]]

3. 集成方法：最后，我们尝试了集成方法，使用了 Boosting 方法对模型进行集成，以提高模型的泛化能力和预测准确率。
   这里，我们使用的是 AdaBoost 算法，对模型进行集成，其主要思想是通过不断调整数据的权重，使得前一个基学习器分错的样本在后一个基学习器中得到更多的关注，从而提高模型的准确率。我们发现通过 AdaBoost 算法对模型进行集成，模型的准确率有所提升。
   ![[adaboost.png]]

## 3 对于改进之后的模型与原模型进行对比

将改进后的模型与原模型进行对比，发现改进后的模型在准确率上有所提升，RUC 曲线上与原来大致相当，说明我们的优化方法在一定程度上是有效的。
![[改进后的模型.png]]

# 回测分析

最后，将改进后的模型应用于 test 数据中，进行回测分析，以验证模型的实陵性和稳定性。我们采用了简单的回测框架，绘制了交易价格图像，将预测的买卖方向在图中标注出来，其中绿色代表买入，红色代表卖出。通过回测分析，我们发现价格变化和预测的买卖方向还是大致匹配的，说明模型的预测效果较好，具有一定的实陵性和稳定性。
![[回测.png]]

# 总结

通过对万科 A 的限价订单簿高频数据的深入分析，我们成功构建了一系列有效的交易方向预测模型。在特征选择阶段，我们提取了反映市场价格行为和流动性特征的多维度特征。在数据预处理阶段，我们通过数据清洗、缺失值处理、去极值和标准化等步骤，确保了数据的完整性和准确性。在基础模型训练阶段，我们比较了 SVM、Logistic 回归、决策树、朴素贝叶斯和集成模型等多种模型的性能，发现 Logistic 回归模型表现最佳。

针对 Logistic 回归模型，我们进一步进行了特征重要性分析、参数调整、正则化和集成方法的优化，显著提升了模型的准确率和泛化能力。最后，通过回测分析，我们验证了模型在实际交易中的有效性和稳定性。总体而言，本研究不仅为量化投资策略的设计提供了理论支持，也为实际投资决策提供了实践指导。